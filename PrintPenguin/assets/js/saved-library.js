let savedLibraryList = {
    result: [
      {
        folderPath: 'D:/Test/WebArray_Projekty/PrintPenguin',
        files: [
          {
            files_name: 'Business Card Red Design',
            image: 'img-05.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Poster Programming Event Poster Programming Event Poster Programming Event',
            image: 'img-05.png',
            folder_color: 'blue',
            files: [
              {
                files_name: 'Poster Programming Event P1',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P2',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P3',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P4',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P5',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P6',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P7',
                image: 'img-07.png'
              }
            ]
          },
          {
            files_name: 'Travel sale flyer Design',
            image: 'img-02.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Slow Sundays T-Shirt - Off White',
            image: 'img-03.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Twin Mug Mockup',
            image: 'img-01.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Bucket Hat Green',
            image: 'img-04.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Business Card Red Design',
            image: 'img-05.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Poster Programming Event',
            image: 'img-05.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Travel sale flyer Design',
            image: 'img-02.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Slow Sundays T-Shirt - Off White',
            image: 'img-03.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Twin Mug Mockup',
            image: 'img-01.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Bucket Hat Green',
            image: 'img-04.png',
            folder_color: null,
            files: null
          }
        ]
      },
      {
        folderPath: 'D:/Test/WebArray_Projekty',
        files: [
          {
            files_name: 'Business Card Red Design',
            image: 'img-05.png',
            folder_color: null,
            files: null
          },
          {
            files_name: 'Poster Programming Event Poster Programming Event Poster Programming Event',
            image: 'img-05.png',
            folder_color: 'red',
            files: [
              {
                files_name: 'Poster Programming Event P1',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P2',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P3',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P4',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P5',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P6',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P7',
                image: 'img-07.png'
              }
            ]
          },
          {
            files_name: 'Travel sale flyer Design',
            image: 'img-02.png',
            files: null
          },
          {
            files_name: 'Slow Sundays T-Shirt - Off White',
            image: 'img-03.png',
            files: null
          }
        ]
      },
      {
        folderPath: 'D:/Test',
        files: [
          {
            files_name: 'Business Card Red Design',
            image: 'img-05.png',
            files: null
          },
          {
            files_name: 'Poster Programming Event Poster Programming Event Poster Programming Event',
            image: 'img-05.png',
            folder_color: 'red',
            files: [
              {
                files_name: 'Poster Programming Event P1',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P2',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P3',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P4',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P5',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P6',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P7',
                image: 'img-07.png'
              }
            ]
          },
          {
            files_name: 'Travel sale flyer Design',
            image: 'img-02.png',
            files: null
          },
          {
            files_name: 'Slow Sundays T-Shirt - Off White',
            image: 'img-03.png',
            files: null
          },
          {
            files_name: 'Travel sale flyer Design',
            image: 'img-02.png',
            files: null
          },
          {
            files_name: 'Slow Sundays T-Shirt - Off White',
            image: 'img-03.png',
            files: null
          },
          {
            files_name: 'Travel sale flyer Design',
            image: 'img-02.png',
            files: null
          },
          {
            files_name: 'Slow Sundays T-Shirt - Off White',
            image: 'img-03.png',
            files: null
          }
        ]
      },
      ,
      {
        folderPath: 'D:',
        files: [
          {
            files_name: 'Poster Programming Event Poster Programming Event Poster Programming Event',
            image: 'img-05.png',
            folder_color: 'green',
            files: [
              {
                files_name: 'Poster Programming Event P1',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P2',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P3',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P4',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P5',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P6',
                image: 'img-07.png'
              },
              {
                files_name: 'Poster Programming Event P7',
                image: 'img-07.png'
              }
            ]
          }
        ]
      }
    ]
}

let savedLibraryContentModal = document.getElementById('savedLibraryContentModal');

let draggable;

let countItem = 0;
if(savedLibraryContentModal){
    
    savedLibraryList.result[0].files.forEach((item) => {

        let productItem = createSavedLibraryModalItem(item.files_name, item.image, item.folder_color, countItem++, item.files);
        savedLibraryContentModal.append(productItem);
    })

    savedLibraryContentModal.querySelectorAll('.glightbox').forEach((el) => el.addEventListener('click', (e) => {
      e.preventDefault();
      const lightbox = GLightbox();
      lightbox.open(); 
    }));
}





/* *********************************************** */
/********* CREATE SAVED LIBRARY MODAL ITEM *********/
/* *********************************************** */
function createSavedLibraryModalItem(productName, urlImg, folderColor, countId, folder){

    let col = createNewElement('div', 'col-12 col-md-6 col-xl-4 mb-4');
    
    let input = createNewElement('input', 'btn-check');
    input.type = 'radio';
    input.name = 'saveLibraryFiles[]';
    input.id = `saved-library-${countId}`;
    col.append(input);

    let label = createNewElement('label', 'label-check saved-library-item');
    if(!folder){
      label.style.backgroundImage = `url('../../assets/img/saved-library/${urlImg}')`;

    }
    label.setAttribute('for', `saved-library-${countId}`);
    col.append(label);

    let linkLightBox = createNewElement('a', 'full-size-img glightbox', 'Full Size');
    linkLightBox.href = `../../assets/img/saved-library/${urlImg}`;
    label.append(linkLightBox);


    let iconZoomIn = createNewElement('span', 'fi-rr-zoom-in me-1');
    linkLightBox.prepend(iconZoomIn);

    let productNameDiv = createNewElement('span', 'saved-library-item-name text-center', productName);
    col.append(productNameDiv);


    if (folder != null){

      label.classList.remove('label-check');
      label.classList.add('folder-bg');
      label.addEventListener('click', ev => {
        onclickOpenSavedLibraryFolder(folder);
      });

      label.dataset.countFiles = `${folder.length} Files`;


      let imgFolder = createNewElement('div', 'folder-bg-img');
      label.append(imgFolder);

      if(folderColor != null){

        if(folderColor == 'blue'){
          imgFolder.classList.add('folder-blue');
        } else if(folderColor == 'red'){
          imgFolder.classList.add('folder-red');
        } else if(folderColor == 'yellow'){
          imgFolder.classList.add('folder-yellow');
        } else if(folderColor == 'green'){
          imgFolder.classList.add('folder-green');
        } else {
          imgFolder.classList.add('folder-blue');
        }
      }
      
      linkLightBox.classList.add('d-none');
      input.remove();



    }   

    return col;
}




/* *********************************************** */
/**** CREATE SAVED LIBRARY MODAL ADDITIONAL ITEM ***/
/* *********************************************** */
function createSavedLibraryAdditionalItem(productName, urlImg, countId){
    let col = createNewElement('div', 'col-12 col-md-6 col-xl-4 mb-4');
    col.dataset.aos = 'flip-up';
    col.dataset.aosDelay = `${countId}00`;

    
    let input = createNewElement('input', 'btn-check');
    input.type = 'radio';
    input.name = 'saveLibraryFiles[]';
    input.id = `saved-library-files${countId}`;
    col.append(input);

    let label = createNewElement('label', 'label-check saved-library-item');
    label.style.backgroundImage = `url('/assets/img/saved-library/${urlImg}')`;
    label.setAttribute('for', `saved-library-files${countId}`);
    col.append(label);

    let linkLightBox = createNewElement('a', 'full-size-img glightbox', 'Full Size');
    linkLightBox.href = `../../assets/img/saved-library/${urlImg}`;
/*     linkLightBox.dataset.toggle = 'lightbox';
    linkLightBox.dataset.gallery = 'example-gallery'; */
    label.append(linkLightBox);


    let iconZoomIn = createNewElement('span', 'fi-rr-zoom-in me-1');
    linkLightBox.prepend(iconZoomIn);

    let productNameDiv = createNewElement('span', 'saved-library-item-name text-center', productName);
    col.append(productNameDiv);

    return col;
}





/* *********************************************** */
/************** OPEN FOLDER SAVED LIBRARY **********/
/* *********************************************** */
function onclickOpenSavedLibraryFolder(files){

  countItem = 0;

  savedLibraryContentModal.innerHTML = '';

  let backToLibraryBtn = createBackToLibraryBtn();
  savedLibraryContentModal.append(backToLibraryBtn);
  
  files.forEach((file) => {
    let productItem = createSavedLibraryAdditionalItem(file.files_name, file.image, countItem++);
    savedLibraryContentModal.append(productItem);
  })

  savedLibraryContentModal.querySelectorAll('.glightbox').forEach((el) => el.addEventListener('click', (e) => {
    e.preventDefault();
    const lightbox = GLightbox();
    lightbox.open(); 
  }));

  initAos();
}





/* *********************************************** */
/************ CREATE BTN BACK TO LIBRARY ***********/
/* *********************************************** */
function createBackToLibraryBtn(){

  let col = createNewElement('div', 'col-12 col-md-6 col-xl-4 mb-4');

  let button = createNewElement('button', 'saved-library-item saved-library-item-back-btn btn-animation-arrow');
  button.type = 'button';
  button.addEventListener('click', onclickUpdateLibrary);
  col.append(button);

  let bgIcon = createNewElement('span', 'btn-icon-bg-grey d-flex align-items-center justify-content-center');
  button.append(bgIcon);

  let icon = createNewElement('span', 'fi-rr-arrow-left btn-animation-arrow-left d-inline-block');
  bgIcon.append(icon);

  let nameBtn = createNewElement('span', 'text-center text-drab text-sm d-block fw-semibold mt-2', 'Back to Library');
  col.append(nameBtn);


  return col;

}




/* *********************************************** */
/*********** BACK TO UPDATE LIBRARY ****************/
/* *********************************************** */
function onclickUpdateLibrary(){

  savedLibraryContentModal.innerHTML = '';

  savedLibraryList.result[0].files.forEach((item) => {

    let productItem = createSavedLibraryModalItem(item.files_name, item.image, item.folder_color, countItem++, item.files);
    savedLibraryContentModal.append(productItem);
  })

  savedLibraryContentModal.querySelectorAll('.glightbox').forEach((el) => el.addEventListener('click', (e) => {
    e.preventDefault();
    const lightbox = GLightbox();
    lightbox.open(); 
  }));
}




/* *********************************************** */
/******* UPLOAD FILE FROM SAVED LIBRARY MODAL*******/
/* *********************************************** */
let modalSavedLibrary;

if(document.getElementById('modalSavedLibrary')){
  modalSavedLibrary = document.getElementById('modalSavedLibrary');

}

let uploadSavedLibraryModalBtn = document.getElementById('uploadSavedLibraryModalBtn');

if(uploadSavedLibraryModalBtn){
  uploadSavedLibraryModalBtn.addEventListener('click', event => {

      let selectedInput, selectedFile;

      let savedLibraryForm = modalSavedLibrary.querySelector('#savedLibraryForm');

      let inputs = savedLibraryForm.querySelectorAll('input[type="radio"]');

      inputs.forEach(input => {

        if(input.checked){

          selectedInput = input;
          selectedFile = selectedInput.nextElementSibling.style;

        }
      })

      if(selectedFile){
        
        let id = uploadSavedLibraryModalBtn.closest('.modal').dataset.fromDragZoneId;

        let fromDragZone = document.getElementById(id);
  
        updateThumbnailUploadDesign(fromDragZone, null, selectedFile);
      }
    
  })
}






/* *********************************************** */
/*************** ACCOUNT SAVED LIBRARY *************/
/* *********************************************** */
function createSavedLibraryItem(productName, urlImg, folderColor, countId, folder){

  let col = createNewElement('div', 'mb-4');
  col.id = `folder-item-${countId}`;

  let item = createNewElement('div', 'saved-design-library-item');
  col.append(item);

  let img = createNewElement('div', 'saved-design-library-item-img position-relative');

  if(!folder){

    col.classList.add('draggable-item');

    img.style.backgroundImage = `url('../../assets/img/saved-library/${urlImg}')`;
  }

  if (folder != null){

    col.classList.add('prevent-dragging-before');

    item.classList.add('saved-design-library-item-folder', 'js-draggable-container');

    img.classList.add('folder-bg');

    if(folder.length > 0){
      img.dataset.countFiles = `${folder.length} Files`;
    }

    let imgFolder = createNewElement('div', 'folder-bg-img');
    img.append(imgFolder);

    if(folderColor != null){

      if(folderColor == 'blue'){
        imgFolder.classList.add('folder-blue');
      } else if(folderColor == 'red'){
        imgFolder.classList.add('folder-red');
      } else if(folderColor == 'yellow'){
        imgFolder.classList.add('folder-yellow');
      } else if(folderColor == 'green'){
        imgFolder.classList.add('folder-green');
      } else {
        imgFolder.classList.add('folder-blue');
      }
    }

  }

  item.append(img);

  let dropdown = createNewElement('div', 'dropdown');
  img.append(dropdown);

  let editBtn = createNewElement('button', 'btn btn-link btn-edit-saved-library dropdown-toggle');
  editBtn.id = `folder-${countId}`;
  editBtn.type = 'button';
  editBtn.dataset.bsToggle = 'dropdown';
  editBtn.dataset.bsAutoClose = 'outside';
  editBtn.setAttribute('aria-expanded', 'false'); 
  editBtn.addEventListener('click', openEditFolderMenu);
  dropdown.append(editBtn);

  let editMenu = createDropDownMenuEditFolder(`folder-${countId}`, col.id, urlImg, folder, productName);
  dropdown.append(editMenu);


  let icon = createNewElement('span', 'icon-more-circle');
  editBtn.append(icon);

  let productNameDiv = createNewElement('span', 'saved-library-item-name saved-design-library-item-name text-center', productName);
  item.append(productNameDiv);

  return col;
}




/* *********************************************** */
/******************* CREATE NEW FOLDER *************/
/* *********************************************** */
let createNewFolderBtn = document.getElementById('createNewFolderBtn');
let addNewFolderName = document.getElementById('addNewFolderName');
let folderColorInputs = document.getElementById('folderColorInputs');

let addNewFolderModal = document.getElementById('addNewFolderModal');

if(addNewFolderModal){
  addNewFolderModal.addEventListener('show.bs.modal', function (event) {

    addNewFolderModal.querySelector('#addNewFolderForm').reset();
  })
}


if(createNewFolderBtn){
  createNewFolderBtn.addEventListener('click', createNewFolder);
}

let idCountNewFolder = 0;



function createNewFolder(){

  let folderName = addNewFolderName.value;
  
  let folderColor;
  idCountNewFolder++;

  folderColorInputs.querySelectorAll('input[type="radio"]').forEach(input => {
    
    if(input.checked){
      folderColor = input.value;
    }
  })

  if(folderName == ''){
    folderName = `New Folder ${idCountNewFolder}`;
  }

  let folder = createSavedLibraryItem(folderName, '', folderColor, `new-${idCountNewFolder}`, true);

  savedDesignLibraryContent.prepend(folder); /* <-- todo api add new folder */

  updateDraggable(document.querySelectorAll('.js-draggable-container'));

}





/* *********************************************** */
/******** CREATE DROP DOWN MENU EDIT FOLDER ********/
/* *********************************************** */
function createDropDownMenuEditFolder(id, colId, urlImg, folder, folderName) {
  let ul = createNewElement('ul', 'dropdown-menu dropdown-menu-edit-folder');
  ul.setAttribute('aria-labelledby', `${id}`);

  let countEditLinks = 0;

  if(folder){

    countEditLinks = 6;

    for(let i = 1; i <= countEditLinks; i++){

      let li = createNewElement('li');
      let link = createNewElement('a', 'dropdown-item d-flex align-items-center');
      let linkName = createNewElement('span', 'lh-1');
      let icon = createNewElement('span', 'text-sm me-2 lh-1');
      
  
      if( i == 1){
        linkName.innerHTML += 'Change Color';
        icon.classList.add('fi-rr-palette');
        link.dataset.bsToggle = 'modal';
        link.dataset.bsTarget = '#changeColorFolderModal';
        link.dataset.bsFolderId = colId;
        
      } else if( i == 2){
        linkName.innerHTML += 'Share Folder';
        icon.classList.add('fi-rr-link');
      } else if( i == 3){
        linkName.innerHTML += 'Download (.zip)';
        icon.classList.add('fi-rr-download');
      } else if( i == 4){
        linkName.innerHTML += 'Rename';
        icon.classList.add('fi-rr-pencil');
        link.dataset.bsToggle = 'modal';
        link.dataset.bsTarget = '#renameFolderModal';
        link.dataset.bsFolderId = colId;

      } else if( i == 5){
        link.classList.add('justify-content-between', 'dropdown-toggle');
        linkName.innerHTML += 'Move';
        linkName.classList.add('flex-fill');
        icon.classList.add('fi-rr-arrows');
        
      } else if( i == 6){
        linkName.innerHTML += 'Delete';
        link.classList.add('text-red');
        icon.classList.add('fi-rr-trash');
        link.addEventListener('click', deleteFolder);
        link.dataset.deleteFolderId = colId;
        link.dataset.deleteFolderName = folderName;
      } 

        li.append(link);
        link.prepend(icon);
        link.append(linkName);
        ul.append(li);

        if(linkName.innerText == 'Move'){          

          link.id = `move-dropdown-menu-${id}`;
          link.role = 'button';
          link.classList.add('dropdown-not-arrow', 'dropdown-toggle');
          link.addEventListener('click', openDropdownMenuMobileVersion);
          link.dataset.bsToggle = 'dropdown';
          link.setAttribute('aria-expanded', 'false'); 
          link.setAttribute('aria-haspopup', 'true'); 

          li.classList.add('dropdown', 'dropend');

          let arrowRightIcon = createNewElement('span', 'icon-arrow-right-3');
          link.append(arrowRightIcon);

          let dropdownMenuMove = createDropDownMenuMoveTo(`move-dropdown-menu-${id}`);
          li.append(dropdownMenuMove);

        }
       
    }
  } else {

      countEditLinks = 8;
      
      for(let i = 1; i <= countEditLinks; i++){
  
        let li = createNewElement('li');
        let link = createNewElement('a', 'dropdown-item d-flex align-items-center');
        let linkName = createNewElement('span', 'lh-1');
        let icon = createNewElement('span', 'text-sm me-2 lh-1');
        
        link.href = '#';
    
        if( i == 1){
          linkName.innerHTML += 'Order Print';
          icon.classList.add('fi-rr-shopping-cart');
        } else if( i == 2){
          linkName.innerHTML += 'Request Changes';
          icon.classList.add('fi-rr-refresh');
        } else if( i == 3){
          linkName.innerHTML += 'Request Variations'; 
          link.classList.add('pb-3');
          link.href = '/design-revisions-dashboard';
          icon.classList.add('fi-rr-duplicate');
        } else if( i == 4){
          linkName.innerHTML += 'See Full Size';
          icon.classList.add('fi-rr-resize');
          link.classList.add('pt-3');
          link.dataset.bsToggle = 'modal';
          link.dataset.bsTarget = '#modaFullSizeFile';
          link.addEventListener('click', function() {
            onclickShowFullSizeFileModal(`../../assets/img/saved-library/${urlImg}`);
          });

        /*   link.setAttribute('target', '_blank');
          link.href = `/assets/img/saved-library/${urlImg}`;  */
        } else if( i == 5){
          linkName.innerHTML += 'Download';
          link.classList.add('pb-3');
          icon.classList.add('fi-rr-download');
        } else if( i == 6){
          linkName.innerHTML += 'Rename';
          link.classList.add('pt-3');
          icon.classList.add('fi-rr-pencil');
          link.dataset.bsToggle = 'modal';
          link.dataset.bsTarget = '#renameFolderModal';
          link.dataset.bsFolderId = colId;

        } else if( i == 7){
          link.classList.add('justify-content-between', 'dropdown-toggle');
          linkName.innerHTML += 'Move';
          linkName.classList.add('flex-fill');
          icon.classList.add('fi-rr-arrows');
        } else if( i == 8){
          linkName.innerHTML += 'Delete';
          icon.classList.add('fi-rr-trash');
          link.classList.add('text-red');
          link.addEventListener('click', deleteFolder);
          link.dataset.deleteFolderId = colId;
          link.dataset.deleteFolderName = folderName;

        }
    
        li.append(link);
        link.prepend(icon);
        link.append(linkName);
        ul.append(li);

        if(linkName.innerText == 'Move'){          

          link.id = `move-dropdown-menu-${id}`;
          link.role = 'button';
          link.dataset.bsToggle = 'dropdown';
          link.classList.add('dropdown-not-arrow', 'dropdown-toggle');
          link.addEventListener('click', openDropdownMenuMobileVersion);
          link.setAttribute('aria-expanded', 'false'); 
          link.setAttribute('aria-haspopup', 'true'); 

          li.classList.add('dropdown', 'dropend');



          let arrowRightIcon = createNewElement('span', 'icon-arrow-right-3');
          link.append(arrowRightIcon);

          let dropdownMenuMove = createDropDownMenuMoveTo(`move-dropdown-menu-${id}`);
          li.append(dropdownMenuMove);

        }

        if(i == 3 || i == 5){
          
          let hr = createNewElement('hr', 'mx-4 my-0');
          li.append(hr);
        }
        
    }
  }
  
  return ul;

}




/* *********************************************** */
/************ CHANGE COLOR FOLDER MODAL ************/
/* *********************************************** */
let changeColorFolderModal = document.getElementById('changeColorFolderModal');

if(changeColorFolderModal){

  changeColorFolderModal.addEventListener('show.bs.modal', function (event) {

    let colorFolder;

    let id = event.relatedTarget.getAttribute('data-bs-folder-id');

    let changeColorFolderInputs = document.getElementById('changeColorFolderInputs');

    let colorFolderInputs = changeColorFolderInputs.querySelectorAll('input');
  
    colorFolderInputs.forEach(input => {
  
      input.addEventListener('change', () => {

        colorFolder = input.value;
  
      });

    })



    let changeColorFolderModalBtn = document.getElementById('changeColorFolderModalBtn');

    changeColorFolderModalBtn.addEventListener('click', () => {

      changeColorFolder(id, colorFolder);

    });

  })

}


function changeColorFolder(id, colorFolder){

  let folder = document.getElementById(id);

  let folderImg = folder.querySelector('.folder-bg-img');

  if(colorFolder == 'blue'){
    folderImg.className = 'folder-bg-img folder-blue';
  } else if(colorFolder == 'red'){
    folderImg.className = 'folder-bg-img folder-red';
  } else if(colorFolder == 'yellow'){
    folderImg.className = 'folder-bg-img folder-yellow';
  } else if(colorFolder == 'green'){
    folderImg.className = 'folder-bg-img folder-green';
  } else {
    folderImg.className = 'folder-bg-img folder-blue';
  }
  /* todo add change color folder Api */

}




/* *********************************************** */
/**************** RENAME FOLDER MODAL **************/
/* *********************************************** */
let renameFolderModal = document.getElementById('renameFolderModal');

if(renameFolderModal){

  renameFolderModal.addEventListener('show.bs.modal', function (event) {

    let newNameFolder;
    let id = event.relatedTarget.getAttribute('data-bs-folder-id');
    let input = renameFolderModal.querySelector('#renameFolderInput');
    input.value = '';

    input.addEventListener('change', () => {

      newNameFolder = input.value;
  
    });

    let renameFolderModalBtn = document.getElementById('renameFolderModalBtn');

    renameFolderModalBtn.addEventListener('click', () => {

      renameFolder(id, newNameFolder);

    });

  })
}


function renameFolder(id, name) {

  let folder = document.getElementById(id);

  let folderName = folder.querySelector('.saved-library-item-name');
  folderName.innerHTML = name;

  /* todo <-- add rename folder Api */
  
}




/* *********************************************** */
/********** CREATE DROP DOWN MENU MOVE TO **********/
/* *********************************************** */
function createDropDownMenuMoveTo(id){
  let ul = createNewElement('ul', 'dropdown-menu dropdown-menu-edit-folder dropdown-menu-end');
  ul.setAttribute('aria-labelledby', `${id}`);

  let countEditLinks = 3;

    for(let i = 1; i <= countEditLinks; i++){

      let li = createNewElement('li', 'list-dropdown-move');
      let link = createNewElement('a', 'dropdown-item d-flex align-items-center');
      let linkName = createNewElement('span', 'lh-1');
      let icon = createNewElement('span', 'text-sm me-2 lh-1');
      
  
      link.href = '#';
      if( i == 1){
        linkName.innerHTML += 'Move To Root';
        icon.classList.add('fi-rr-link');
      } else if( i == 2){
        linkName.innerHTML += 'Move To Root';
        icon.classList.add('fi-rr-link');
      } else if( i == 3){
        linkName.innerHTML += 'Create To New Folder';
        icon.classList.add('fi-rr-link');
      }

        li.append(link);
        link.prepend(icon);
        link.append(linkName);
        ul.append(li);

        if(i == 2){
          let hr = createNewElement('hr', 'mx-4 my-0');
          li.append(hr);
        }
    }

  
  return ul;
}






/* *********************************************** */
/******** OPEN DROPDOWN MRNU MOBILE VERSION ********/
/* *********************************************** */
function openDropdownMenuMobileVersion(event){

  if(window.innerWidth < 768) {

   event.currentTarget.closest('ul').classList.add('dropdown-menu-mobile-hide');

  }

}




/* *********************************************** */
/************** OPEN EDIT FOLDER MENU **************/
/* *********************************************** */
function openEditFolderMenu(event){
  if(event.currentTarget.nextElementSibling.classList.contains('dropdown-menu-mobile-hide')){
    event.currentTarget.nextElementSibling.classList.remove('dropdown-menu-mobile-hide')
  }
}




/* *********************************************** */
/******************* DELETE FOLDER *****************/
/* *********************************************** */
function deleteFolder(){

  let id = this.getAttribute('data-delete-folder-id');
  let name = this.getAttribute('data-delete-folder-name');

  createAreYouSureGlobalModal(`Are you sure you want to delete the file named (${name})?`, 'Delete File', 'Close');

  bsAreYouSureGlobalModal.show();

  let deleteBtn = areYouSureGlobalModal.querySelector('#areYouSureGlobalModalMainBtn');
  deleteBtn.dataset.savedFolderId = id;
  
  deleteBtn.onclick = onclickSavedFolderDeleteConfirmBtn;

}

function onclickSavedFolderDeleteConfirmBtn(ev){

  let el = document.getElementById(ev.target.getAttribute('data-saved-folder-id'));
  el.remove();  /* <-- todo CREATE FUNCTION DELETE FOLDER FROM API */

  
}





/* *********************************************** */
/************ UPDATE ADDRESS FOLDER ****************/
/* *********************************************** */
let savedDesignLibraryContent = document.getElementById('savedDesignLibraryContent');
let foldersPathPanel = document.getElementById('foldersPathPanel');

let dropdownMenuAddressFolders = document.getElementById('dropdownMenuAddressFolders');
let folderPrevBtn = document.getElementById('folderPrevBtn');
let folderActive = document.getElementById('folderActive');
let folderPathHomeIcon = document.getElementById('folderPathHomeIcon');
let prevFolderBtnArrow = document.getElementById('prevFolderBtnArrow');

let currentFolderPath, beforeCurrentFolderPath;

if(savedDesignLibraryContent){
  updateSavedLibraryContent(savedLibraryList.result[0]);

 /*  updateDraggable(document.querySelectorAll('.js-draggable-container')); */

}

function updateSavedLibraryContent(folderItem) {

  dropdownMenuAddressFolders.innerHTML = '';
  savedDesignLibraryContent.innerHTML = '';

  
  currentFolderPath = folderItem.folderPath;
  let foldersName = currentFolderPath.split('/');


  let lastFolder = foldersName.pop();
  folderActive.innerHTML = `[${lastFolder}]`;

  beforeCurrentFolderPath = foldersName.join('/');

  let beforeLastFolder = foldersName.pop();
  folderPrevBtn.innerHTML = `[${beforeLastFolder}]`;

  let dropdown = foldersPathPanel.querySelector('.dropdown');

  if(foldersName.length == 0){

    dropdown.classList.add('d-none');
    dropdown.nextElementSibling.classList.add('d-none');
    folderPrevBtn.innerHTML = '';
    let homeIcon = createNewElement('span', 'home-icon bg-filter-grey');
    folderPrevBtn.append(homeIcon);

  }
  if(!beforeLastFolder){
     foldersPathPanel.classList.add('d-none');
     folderPathHomeIcon.classList.remove('d-none');
  }

  folderPrevBtn.addEventListener('click', e => {
    onFolderPathClicked(beforeCurrentFolderPath);
  })

  do {

    let popFolderPath = foldersName.join('/');
    let popFolder = foldersName.pop();

    if (foldersName.length == 0){
      popFolder = 'Root';
    }

    let item = createDropDownMenuFolderPaths(popFolder, popFolderPath);
    dropdownMenuAddressFolders.append(item);

  } while (foldersName.length > 0);
    
  let countItem = 0;

    folderItem.files.forEach((item) => {

        let productItem = createSavedLibraryItem(item.files_name, item.image, item.folder_color, countItem++, item.files);

        if(item.files)
        {
          savedDesignLibraryContent.prepend(productItem);
          return;
        }
        savedDesignLibraryContent.append(productItem);
    })

  updateDraggable(document.querySelectorAll('.js-draggable-container'));

}





/* **************************************************/
/* ********************* DRAGGABLE ******************/
/* **************************************************/
/* import Scrollable, {defaultOptions} from './Scrollable';

export default Scrollable;
export {defaultOptions}; */

function updateDraggable(allDraggableContainers){

  if (draggable){
    draggable.destroy();
  }

  draggable = new Draggable.Sortable(allDraggableContainers, {
    draggable: '.draggable-item',
    distance: 5,
    delay: 120,
    autoScroll: 2,
	/*
    autoScrollSpeed: 10,
    autoScrollTarget: window,
	forceFallback: true,
	*/
    scrollable: {
      speed: 10,
      sensitivity: 50
    }
  });


  draggable.on('draggable:initialize', (evt) => { 
    const draggableElement = evt.data.source; 
      if (draggableElement.previousElementSibling?.classList.contains('prevent-dragging-before')) {
        evt.cancel(); 
      } 
  });

  draggable.on('drag:start', () => {
    for(let item of document.querySelectorAll('.draggable-item')){

      item.classList.add('disabled');

    }
  });
  
  draggable.on('drag:stop', (e) => {
    for(let item of document.querySelectorAll('.draggable-item')){
      item.classList.remove('disabled');
    }
  });

  draggable.on('sortable:sorted', (e) => {
    if (e.newContainer != e.oldContainer) {
      e.data.dragEvent.source.classList.add('d-none');
    } else {
      e.data.dragEvent.source.classList.remove('d-none');
    }
  });

  draggable.on('sortable:stop', (e) => {
    
    if (e.newContainer != e.oldContainer) {
      e.data.dragEvent.originalSource.classList.add('d-none');
    }
  });
}

    

if(prevFolderBtnArrow){
  prevFolderBtnArrow.addEventListener('click', e => {
    onFolderPathClicked(beforeCurrentFolderPath);
  })
}





/* *********************************************** */
/*************** FOLDER PATH UPDATE ****************/
/* *********************************************** */
function onFolderPathClicked(folderPath) {

  let newFolderResult = savedLibraryList.result.filter(x => x.folderPath == folderPath);

  if(newFolderResult.length == 1){
    updateSavedLibraryContent(newFolderResult[0]);
  }
}




/* *********************************************** */
/****** CREATE DROP DOWN MENU ADDRESS FOLDERS ******/
/* *********************************************** */
function createDropDownMenuFolderPaths(folderName, folderPath){

  let li = createNewElement('li');
  let link = createNewElement('button', 'dropdown-item', `[${folderName}]`);
  
  link.type = 'button';
  link.dataset.folderPath = folderPath;

  link.addEventListener('click', e => {
    let fPath = e.currentTarget.dataset.folderPath;
    onFolderPathClicked(fPath); 
  })

  li.append(link);

  return li;
}
 




/* *********************************************** */
/*********** CREATE BTNS ARTWORK LIBRARY ***********/
/* *********************************************** */
let artworkLibraryBtns = document.getElementById('artworkLibraryBtns');

if(artworkLibraryBtns){

  let searchBtn = createCircleIconBtnAnimation('btn-blue', 'wa-wa-search', 'Search');
  searchBtn.classList.add('me-2');
  searchBtn.id = 'searchFolderBtn';
  artworkLibraryBtns.append(searchBtn);

  let uploadBtn = createCircleIconBtnAnimation('btn-blue', 'wa-wa-upload', 'Upload');
  uploadBtn.classList.add('me-2');
  artworkLibraryBtns.append(uploadBtn);

  let newFolderBtn = createCircleIconBtnAnimation('btn-blue', 'wa-wa-plus', 'Folder');
  newFolderBtn.dataset.bsTarget = '#addNewFolderModal';
  newFolderBtn.dataset.bsToggle = 'modal';
  artworkLibraryBtns.append(newFolderBtn);

}





/* *********************************************** */
/***************** SEARCH ANIMATION ****************/
/* *********************************************** */
let containerSearchFolder = document.getElementById('containerSearchFolder');
let foldersPathContent = document.getElementById('foldersPathContent');
let searchFilesInput = document.getElementById('searchFilesInput');
let searchFolderBtn = document.getElementById('searchFolderBtn');
let searchCloseBtn = document.getElementById('searchCloseBtn');

if(containerSearchFolder){

  searchFolderBtn.addEventListener('click', e =>{
    foldersPathContent.classList.add('d-none');
    containerSearchFolder.classList.remove('d-none');
    searchCloseBtn.classList.remove('d-none');
    searchFolderBtn.classList.add('active');
    searchFilesInput.focus();
  })

  containerSearchFolder.addEventListener('focusout', e =>{
    foldersPathContent.classList.remove('d-none');
    containerSearchFolder.classList.add('d-none');
    searchCloseBtn.classList.add('d-none');
    searchFolderBtn.classList.remove('active');
    searchFilesInput.focus();
    searchFilesInput.value = '';
  })

}




